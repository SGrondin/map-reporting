(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(){var mapUtils;mapUtils=require("./mapUtils");exports.Node=function(){function Node(parent,type,inner,cdata){var _ref;this.parent=parent;this.type=type;this.inner=inner!=null?inner:"";this.cdata=cdata!=null?cdata:"";this.children=[];this.attributes={};if((_ref=this.parent)!=null){_ref._addChild(this)}}Node.prototype.setParent=function(obj){if(this.parent==null){this.parent=obj;this.parent._addChild(this)}return this};Node.prototype._addChild=function(obj){this.children.push(obj);return this};Node.prototype.setInner=function(inner){this.inner=inner;return this};Node.prototype.setCDATA=function(cdata){this.cdata=cdata;return this};Node.prototype.setAttributes=function(obj){var k,v;for(k in obj){v=obj[k];this.attributes[k]=v}return this};Node.prototype.toString=function(indent){var k,node,ret,v;if(indent==null){indent=0}if(this.type==="path"&&this.attributes.name!=null){this.attributes.name=mapUtils.toHTML(this.attributes.name)}ret=mapUtils.strRepeat("	",indent)+"<"+this.type+function(){var _ref,_results;_ref=this.attributes;_results=[];for(k in _ref){v=_ref[k];_results.push(" "+k+'="'+v+'"')}return _results}.call(this).join("");if(this.inner.length>0||this.cdata.length>0||this.children.length>0){return ret+=">"+this.inner+this.cdata+function(){var _i,_len,_ref,_results;_ref=this.children;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];_results.push("\n"+node.toString(indent+1))}return _results}.call(this).join("")+"\n"+mapUtils.strRepeat("	",indent)+"</"+this.type+">"}else{return ret+=" />"}};Node.prototype.toDOM=function(addTo,test){var c,el,k,v,_i,_len,_ref,_ref1;el=document.createElementNS("http://www.w3.org/2000/svg",this.type);if(this.inner.length>0){el.appendChild(document.createTextNode(this.inner))}if(this.cdata.length>0&&this.type!=="script"){el.appendChild(document.createTextNode(this.cdata))}_ref=this.attributes;for(k in _ref){v=_ref[k];if(k==="xlink:href"){el.setAttributeNS("http://www.w3.org/1999/xlink",k,v)}else{el.setAttribute(k,v)}}_ref1=this.children;for(_i=0,_len=_ref1.length;_i<_len;_i++){c=_ref1[_i];c.toDOM(el)}return addTo.appendChild(el)};return Node}()}).call(this)},{"./mapUtils":9}],2:[function(require,module,exports){(function(){var Node,mapUtils;mapUtils=require("./mapUtils");Node=require("./Node").Node;exports.SVG=function(){function SVG(config,zones){this.head=new Node(null,"svg");this.head.setAttributes({"class":"mapReporting",version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",id:"mapReporting"+mapUtils.hash(JSON.stringify(config)+JSON.stringify(zones))+"_"+Math.round(Math.random()*99999999),width:config.width,height:config.height,viewBox:"0 0 "+config.width+" "+config.height,preserveAspectRatio:"XMidYMid meet"});this.defs=new Node(this.head,"defs");this.script=new Node(this.head,"script");this.script.setAttributes({type:"text/javascript"});this.style=new Node(this.head,"style");this.style.setAttributes({type:"text/css"})}SVG.prototype.addDef=function(def,id){def.setAttributes({id:"f"+id});def.setParent(this.defs);return"f"+id};SVG.prototype.setEmbeddedJS=function(js){this.script.setCDATA(js);return this};SVG.prototype.setEmbeddedCSS=function(defaultCSS,styling){this.style.setCDATA(defaultCSS+"\n"+mapUtils.buildCSS(styling,this.head.attributes.id));return this};SVG.prototype._addChild=function(obj){this.head._addChild(obj);return this};SVG.prototype.setAttributes=function(obj){this.head.setAttributes(obj);return this};SVG.prototype.toString=function(){return'<?xml version="1.0" standalone="no"?>\n'+this.head.toString(0)};SVG.prototype.toDOM=function(refOrID){var container;container=typeof refOrID==="string"?document.getElementById(refOrID):refOrID;this.head.toDOM(container);return this};return SVG}()}).call(this)},{"./Node":1,"./mapUtils":9}],3:[function(require,module,exports){(function(){var Node,geometry,mapUtils;Node=require("./Node").Node;mapUtils=require("./mapUtils");geometry=require("./geometry");exports.Shape=function(){function Shape(id,link,name,val,d){var pair;this.id=id;this.link=link;this.name=name;this.val=val;this.d=d!=null?d:"";this.link=encodeURI(this.link).replace(/&/g,"%26");this.nextInstruction="M ";this.coordinates=[];pair="[[0-9]{1,5}(.[0-9]{1,5})?,[0-9]{1,5}(.[0-9]{1,5})?]";this.regexes={arc:new RegExp("^arc["+pair+","+pair+","+pair+"]$"),pie:new RegExp("^pie["+pair+","+pair+","+pair+"]$")}}Shape.prototype.resetNextInstruction=function(){this.nextInstruction="M ";return this.d+="Z "};Shape.prototype.addInstruction=function(){var ret;ret=this.nextInstruction;this.nextInstruction="L ";return ret};Shape.prototype.addVector=function(vector,dx,dy){if(this.regexes.arc.test(vector)){this.addArc(vector.slice(3),dx,dy)}else if(this.regexes.pie.test(vector)){this.addPie(vector.slice(3),dx,dy)}else{this.addPoint(vector,dx,dy)}return this};Shape.prototype.addPoint=function(vector,dx,dy){var err,x,y,_ref,_ref1;try{_ref=JSON.parse(vector),x=_ref[0],y=_ref[1];_ref1=[x+dx,y+dy],x=_ref1[0],y=_ref1[1];this.d+=this.addInstruction()+x+" "+y+" ";this.coordinates.push([x,y])}catch(_error){err=_error;console.log("Can't parse "+vector)}return this};Shape.prototype.addArc=function(vector,dx,dy){var angle,err,r1,r2,sweep,xa,xb,xc,xcenter,ya,yb,yc,ycenter,_ref,_ref1,_ref2,_ref3,_ref4;try{_ref=JSON.parse(vector).map(function(_arg){var x,y;x=_arg[0],y=_arg[1];return[x+dx,y+dy]}),_ref1=_ref[0],xa=_ref1[0],ya=_ref1[1],_ref2=_ref[1],xb=_ref2[0],yb=_ref2[1],_ref3=_ref[2],xc=_ref3[0],yc=_ref3[1];try{_ref4=geometry.calculateEllipse(xa,ya,xb,yb,xc,yc),r1=_ref4.r1,r2=_ref4.r2,xcenter=_ref4.xcenter,ycenter=_ref4.ycenter,angle=_ref4.angle,sweep=_ref4.sweep;this.d+=this.addInstruction()+xa+" "+ya+" A "+r1+" "+r2+" "+-angle+" 0 "+sweep+" "+xb+" "+yb+" "}catch(_error){err=_error;this.d+=this.addInstruction()+xa+" "+ya+" L "+xc+" "+yc+" L "+xb+" "+yb+" "}this.coordinates.push([xa,ya],[xb,yb])}catch(_error){err=_error;console.log("Can't parse "+vector)}return this};Shape.prototype.addPie=function(vector,dx,dy){var err,large,r,xa,xb,xc,ya,yb,yc,_ref,_ref1,_ref2,_ref3,_ref4;try{_ref=JSON.parse(vector).map(function(_arg){var x,y;x=_arg[0],y=_arg[1];return[x+dx,y+dy]}),_ref1=_ref[0],xa=_ref1[0],ya=_ref1[1],_ref2=_ref[1],xb=_ref2[0],yb=_ref2[1],_ref3=_ref[2],xc=_ref3[0],yc=_ref3[1];_ref4=geometry.calculatePie(xa,ya,xb,yb,xc,yc),r=_ref4.r,large=_ref4.large;this.d+=this.addInstruction()+xa+" "+ya+" A "+r+" "+r+" 0 "+large+" 1 "+xb+" "+yb+" ";this.coordinates.push([xa,ya],[xb,yb],[xc,yc])}catch(_error){err=_error;console.log("Can't parse "+vector)}return this};Shape.prototype.findCenter=function(){var avgx,avgy;avgx=geometry.avg([this.coordinates[this.coordinates.length-1][0],this.coordinates[0][0],this.coordinates[1][0]]);avgy=geometry.avg([this.coordinates[this.coordinates.length-1][1],this.coordinates[0][1],this.coordinates[1][1]]);return[avgx,avgy]};Shape.prototype.createFilter=function(stroke,radialColor){var filter,innerFilter1,innerFilter2;filter=new Node(null,"radialGradient");innerFilter1=new Node(filter,"stop");innerFilter1.setAttributes({offset:"35%","stop-color":radialColor,"class":"stop1"});innerFilter2=new Node(filter,"stop");innerFilter2.setAttributes({offset:"99%","stop-color":stroke,"class":"stop2"});return filter};Shape.prototype.addToSVG=function(svg,config){var alternateColor,alternateFilter,colors,filter,id,initialColor,initialFilter,node,stroke,value,x,y,_ref,_ref1,_ref2;node=new Node(svg,"path");node.setAttributes({id:this.id,name:this.name,link:this.link,d:this.d.trim()});if(this.val!=null&&this.val!==""&&config.threshold!=null&&config.threshold!==""&&(0<=(_ref=this.val)&&_ref<=100)&&(0<=(_ref1=config.threshold)&&_ref1<=100)){colors={green:mapUtils.getColor((this.val-config.threshold)/(100-config.threshold)*100,"green",false),blue:mapUtils.getColor((this.val-config.threshold)/(100-config.threshold)*100,"blue",false),red:mapUtils.getColor(this.val/config.threshold*100,"red",true)};if(this.val>config.threshold){node.setAttributes({"class":"zone good"});initialColor=colors[config.scale.initial];alternateColor=colors[config.scale.alternate];stroke=initialColor;initialFilter=svg.addDef(this.createFilter(initialColor,initialColor),this.id+"initial");alternateFilter=svg.addDef(this.createFilter(alternateColor,alternateColor),this.id+"alternate");node.setAttributes({fill:"url(#"+initialFilter+")",initialfilter:initialFilter,alternatefilter:alternateFilter,initialcolor:initialColor,alternatecolor:alternateColor})}else{node.setAttributes({"class":"zone bad"});stroke=colors.red;filter=svg.addDef(this.createFilter(colors.red,colors.red),this.id+"initial");node.setAttributes({fill:"url(#"+filter+")"})}value=this.val+"%"}else{stroke="#FFFFFF";value="--";node.setAttributes({fill:"url(#fdashed)","class":"zone"})}node.setAttributes({value:value,stroke:stroke});node.setAttributes({onmouseover:"mapReporting.shapeOver(evt);",onmouseout:"mapReporting.shapeOut(evt);",onmousedown:"mapReporting.shapeDown(evt);"});if(config.showIDs){_ref2=this.findCenter(),x=_ref2[0],y=_ref2[1];y+=20;id=new Node(svg,"text",this.id);id.setAttributes({id:"id"+this.id,x:x,y:y,"class":"zoneid",onmouseover:"mapReporting.IDover(evt);",onmouseout:"mapReporting.IDout(evt);",onmousedown:"mapReporting.IDdown(evt);"})}return this};return Shape}()}).call(this)},{"./Node":1,"./geometry":7,"./mapUtils":9}],4:[function(require,module,exports){(function(){exports.defaultCSS=".mapReporting rect {\n	fill-opacity : 0.7;\n	fill : #FFFFFF;\n}\n.mapReporting text {\n	font-family : Arial;\n}\n.mapReporting a {\n	font-family : Arial;\n	text-decoration : underline;\n}\n.mapReporting .nodatapattern {\n	stroke : #FFFFFF;\n	stroke-opacity : 0.75;\n	stroke-width : 2px;\n}\n.mapReporting .stop1 {\n	stop-opacity : 0.45;\n}\n.mapReporting .stop2 {\n	stop-opacity : 0.85;\n}\n.mapReporting .scaleNumbers {\n	font-weight: bold;\n	font-size:18;\n	fill:#000000;\n	stroke:#FFFFFF;\n	-webkit-user-select : none;\n	-moz-user-select : none;\n	-ms-user-select : none;\n	-o-user-select : none;\n	user-select : none;\n}\n.mapReporting .zoneid {\n	stroke : #000000;\n	fill : #000000;\n	stroke-width : 2px;\n	font-family : Courier;\n	font-size : 32px;\n	-webkit-user-select : none;\n	-moz-user-select : none;\n	-ms-user-select : none;\n	-o-user-select : none;\n	user-select : none;\n}\n.mapReporting .zone {\n	stroke-opacity : 0.4;\n	stroke-width : 4px;\n}\n.mapReporting .selected {\n	stroke : #000000;\n	stroke-opacity : 1;\n	stroke-width : 6px;\n	stroke-dasharray : none;\n}\n.mapReporting .hovered {\n	stroke : #000000;\n	stroke-opacity : 1;\n	stroke-width : 6px;\n	stroke-dasharray : 12,8;\n}"}).call(this)},{}],5:[function(require,module,exports){(function(){exports.getEmbeddedJS=function(labels){var embedded,k,scope,v;scope=module.exports.setClientScope({},labels);embedded="\n<![CDATA[\n";embedded+="var mapReporting = {";for(k in scope){v=scope[k];embedded+="\n"+k+" : ";embedded+=v!=null&&typeof v==="function"?v.toString():v!=null&&typeof v==="object"?JSON.stringify(v):null;embedded+=","}return embedded+="};\n]]>"};exports.setClientScope=function(scope,labels){scope.usingAlternateColor=false;scope.labels=labels;scope.toArray=function(obj){return Array.prototype.slice.call(obj,0)};scope.removeClass=function(element,name){return element.setAttribute("class",element.getAttribute("class").split(" ").filter(function(a){return a!==name}).join(" "))};scope.removeAllClass=function(name){var selected,_i,_len,_ref,_results;_ref=this.toArray(this.head.querySelectorAll("."+name));_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){selected=_ref[_i];_results.push(this.removeClass(selected,name))}return _results};scope.addClass=function(element,name){var arr;arr=element.getAttribute("class").split(" ");arr.push(name);return element.setAttribute("class",arr.join(" "))};scope.hasClass=function(element,name){return element.getAttribute("class").split(" ").indexOf(name)>=0};scope.somethingIsSelected=function(){return this.toArray(this.head.querySelectorAll(".selected"),0).length>0};scope.displayShapeInDashboard=function(shape){this.head.querySelector("#dashboardTitle").firstChild.nodeValue=shape.getAttribute("id")+" "+shape.getAttribute("name");this.head.querySelector("#dashboardLink").setAttribute("xlink:href",shape.getAttribute("link").replace(/&/g,"%26"));this.head.querySelector("#dashboardLink").setAttribute("href",shape.getAttribute("link").replace(/&/g,"%26"));this.head.querySelector("#dashboardLinkText").firstChild.nodeValue=this.labels.link;return this.head.querySelector("#dashboardSatisfaction").firstChild.nodeValue=this.labels.value+shape.getAttribute("value")};scope.emptyDashboard=function(){this.head.querySelector("#dashboardTitle").firstChild.nodeValue="Nothing selected";this.head.querySelector("#dashboardLinkText").firstChild.nodeValue="";return this.head.querySelector("#dashboardSatisfaction").firstChild.nodeValue=""};scope.displaySelected=function(){var selected,_i,_len,_ref,_results;_ref=this.toArray(this.head.querySelectorAll(".selected"));_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){selected=_ref[_i];_results.push(this.displayShapeInDashboard(selected))}return _results};scope.putOnTop=function(shape){var id;this.head.appendChild(shape);id=this.head.querySelector("#id"+shape.getAttribute("id"));if(id!=null){return this.head.appendChild(id)}};scope.putSelectedOnTop=function(){var selected,_i,_len,_ref,_results;_ref=this.toArray(this.head.querySelectorAll(".selected"));_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){selected=_ref[_i];_results.push(this.putOnTop(selected))}return _results};scope.mouseOver=function(shape){this.head=shape.parentNode;if(!this.hasClass(shape,"selected")){this.addClass(shape,"hovered")}this.putOnTop(shape);this.putSelectedOnTop();return this.displayShapeInDashboard(shape)};scope.mouseOut=function(shape){this.head=shape.parentNode;this.removeClass(shape,"hovered");if(this.somethingIsSelected()){return this.displaySelected()}else{return this.emptyDashboard()}};scope.mouseDown=function(shape){var isSelected;this.head=shape.parentNode;isSelected=this.hasClass(shape,"selected");this.removeAllClass("selected");if(isSelected){this.addClass(shape,"hovered")}else{this.removeClass(shape,"hovered");this.addClass(shape,"selected")}return this.putOnTop(shape)};scope.shapeOver=function(evt){return this.mouseOver(evt.target)};scope.shapeOut=function(evt){return this.mouseOut(evt.target)};scope.shapeDown=function(evt){return this.mouseDown(evt.target)};scope.IDover=function(evt){return this.mouseOver(evt.target.parentNode.querySelector("#"+evt.target.getAttribute("id").slice(2)))};scope.IDout=function(evt){return this.mouseOut(evt.target.parentNode.querySelector("#"+evt.target.getAttribute("id").slice(2)))};scope.IDdown=function(evt){return this.mouseDown(evt.target.parentNode.querySelector("#"+evt.target.getAttribute("id").slice(2)))};scope.changeScaleColor=function(evt){var element,elements,_i,_len;this.head=evt.target.parentNode.parentNode;elements=this.toArray(this.head.querySelectorAll(".good"));for(_i=0,_len=elements.length;_i<_len;_i++){element=elements[_i];if(this.usingAlternateColor){element.setAttribute("fill","url(#"+element.getAttribute("initialfilter")+")");element.setAttribute("stroke",element.getAttribute("initialcolor"))}else{element.setAttribute("fill","url(#"+element.getAttribute("alternatefilter")+")");element.setAttribute("stroke",element.getAttribute("alternatecolor"))}}return this.usingAlternateColor=!this.usingAlternateColor};return scope}}).call(this)},{}],6:[function(require,module,exports){(function(){var Node,SVG,Shape,defaultCSS,embeddedJS,mapUtils,shapeFromZone,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};embeddedJS=require("./embeddedJS");mapUtils=require("./mapUtils");SVG=require("./SVG").SVG;Node=require("./Node").Node;Shape=require("./Shape").Shape;defaultCSS=require("./embeddedCSS").defaultCSS;shapeFromZone=function(zone,config){var shape;if(__indexOf.call(zone.coordinates,";")>=0){shape=new Shape(zone.ID,zone.link,zone.name,zone.value);zone.coordinates.split(";;;").forEach(function(s){s.split(";").forEach(function(vector){return shape.addVector(vector,config.background.x,config.background.y)});return shape.resetNextInstruction()})}else{shape=new Shape(zone.ID,zone.link,zone.name,zone.value,zone.coordinates)}return shape};exports.generateMap=function(config,zones){var alternateColor,bg,d,dashboardLink,dashboardLinkText,dashboardSatisfaction,dashboardTitle,desaturation,desaturationFilter,halfDown,halfUp,i,image,initialColor,innerPattern,line,n1,n2,n3,pattern,rectangle,scale,scaleNumbers,svg,value,zone,_i,_j,_k,_len,_ref,_ref1,_ref2,_ref3;svg=new SVG(config,zones);svg.setEmbeddedJS(embeddedJS.getEmbeddedJS(config.labels));if(((_ref=config.background.url)!=null?_ref.length:void 0)>0||((_ref1=config.background.base64)!=null?_ref1.length:void 0)>0){bg=new Node(svg,"image");image=((_ref2=config.background.base64)!=null?_ref2.length:void 0)>0?"data:image/png;base64,"+config.background.base64:config.background.url;bg.setAttributes({"xlink:href":image,x:config.background.x,y:config.background.y,height:config.background.height,width:config.background.width,filter:"url(#fdesaturation)"})}for(_i=0,_len=zones.length;_i<_len;_i++){zone=zones[_i];shapeFromZone(zone,config).addToSVG(svg,config)}pattern=new Node(null,"pattern");pattern.setAttributes({width:"10",height:"10",patternUnits:"userSpaceOnUse"});innerPattern=new Node(pattern,"path");innerPattern.setAttributes({"class":"nodatapattern",d:"M 0 10 L 10 0 Z"});svg.addDef(pattern,"dashed");desaturation=new Node(null,"filter");desaturation.setAttributes({x:0,y:0});desaturationFilter=new Node(desaturation,"feColorMatrix");desaturationFilter.setAttributes({"in":"SourceGraphic",type:"saturate",values:config.background.saturation});svg.addDef(desaturation,"desaturation");scale=new Node(svg,"g");scale.setAttributes({onmousedown:"mapReporting.changeScaleColor(evt);"});halfUp=Math.floor(config.scale.width*~~config.threshold/100);halfDown=halfUp+1;for(i=_j=0;0<=halfUp?_j<=halfUp:_j>=halfUp;i=0<=halfUp?++_j:--_j){value=i/(halfUp/100);line=new Node(scale,"path");line.setAttributes({d:"M "+(config.scale.x+i)+" "+(config.scale.y+config.scale.height)+" L "+(config.scale.x+i)+" "+config.scale.y+" Z",stroke:mapUtils.getColor(value,"red",true),"class":"bad"})}for(i=_k=halfDown,_ref3=config.scale.width;halfDown<=_ref3?_k<=_ref3:_k>=_ref3;i=halfDown<=_ref3?++_k:--_k){value=(i-halfDown)/((config.scale.width-halfUp)/100);line=new Node(scale,"path");d="M "+(config.scale.x+i)+" "+(config.scale.y+config.scale.height)+" L "+(config.scale.x+i)+" "+config.scale.y+" Z";initialColor=mapUtils.getColor(value,config.scale.initial,false);alternateColor=mapUtils.getColor(value,config.scale.alternate,false);line.setAttributes({d:d,stroke:initialColor,initialcolor:initialColor,alternatecolor:alternateColor,"class":"good"})}if(config.scale.showNumbers){scaleNumbers=new Node(svg,"g");n1=new Node(scaleNumbers,"text","0");n1.setAttributes({x:config.scale.x,y:config.scale.y+config.scale.height+14,"class":"scaleNumbers"});n2=new Node(scaleNumbers,"text",config.threshold+"");n2.setAttributes({x:config.scale.x+halfDown,y:config.scale.y+config.scale.height+14,"class":"scaleNumbers"});n3=new Node(scaleNumbers,"text","100");n3.setAttributes({x:config.scale.x+config.scale.width,y:config.scale.y+config.scale.height+14,"class":"scaleNumbers"})}rectangle=new Node(svg,"rect");rectangle.setAttributes({x:config.dashboard.x,y:config.dashboard.y,width:config.dashboard.width,height:config.dashboard.height,id:"dashboardRectangle"});dashboardTitle=new Node(svg,"text","Nothing selected");dashboardTitle.setAttributes({x:config.dashboard.x+10,y:config.dashboard.y+16,id:"dashboardTitle"});dashboardLink=new Node(svg,"a");dashboardLink.setAttributes({"xlink:href":"",href:"",id:"dashboardLink",target:"_blank"});dashboardSatisfaction=new Node(svg,"text"," ");dashboardSatisfaction.setAttributes({x:config.dashboard.x+10,y:config.dashboard.y+41,id:"dashboardSatisfaction"});dashboardLinkText=new Node(dashboardLink,"text"," ");dashboardLinkText.setAttributes({x:config.dashboard.x+10,y:config.dashboard.y+66,id:"dashboardLinkText"});svg.setEmbeddedCSS(defaultCSS,config.styling);return svg}}).call(this)},{"./Node":1,"./SVG":2,"./Shape":3,"./embeddedCSS":4,"./embeddedJS":5,"./mapUtils":9}],7:[function(require,module,exports){(function(){var avg,calculateEllipse,calculatePie,distance,isLeftSide,rotate,sum,toDeg,toRad;distance=function(x1,y1,x2,y2){return Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2))};rotate=function(x,y,a){return[Math.cos(a)*x-Math.sin(a)*y,Math.sin(a)*x+Math.cos(a)*y]};isLeftSide=function(xa,ya,xb,yb,xc,yc){return(xb-xa)*(yc-ya)-(yb-ya)*(xc-xa)>0};toDeg=function(x){return x*(180/Math.PI)};toRad=function(x){return x*(Math.PI/180)};sum=function(arr){return arr.reduce(function(a,b){return a+b})};avg=function(arr){return sum(arr)/arr.length};calculateEllipse=function(xa,ya,xb,yb,xc,yc){var angle,opposite,oxa,oxb,oxc,oya,oyb,oyc,r1,r2,sweep,t,u,xcenter,ycenter,_ref,_ref1,_ref10,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;_ref=[xa,ya,xb,yb,xc,yc],oxa=_ref[0],oya=_ref[1],oxb=_ref[2],oyb=_ref[3],oxc=_ref[4],oyc=_ref[5];_ref1=[(xa+xb)/2,(ya+yb)/2],xcenter=_ref1[0],ycenter=_ref1[1];r1=distance(xa,ya,xcenter,ycenter);opposite=Math.abs(yb-ycenter);angle=Math.asin(opposite/r1);_ref2=[[xa-xcenter,ya-ycenter],[xb-xcenter,yb-ycenter],[xc-xcenter,yc-ycenter]],_ref3=_ref2[0],xa=_ref3[0],ya=_ref3[1],_ref4=_ref2[1],xb=_ref4[0],yb=_ref4[1],_ref5=_ref2[2],xc=_ref5[0],yc=_ref5[1];_ref6=[rotate(xa,ya,angle),rotate(xb,yb,angle),rotate(xc,yc,angle)],_ref7=_ref6[0],xa=_ref7[0],ya=_ref7[1],_ref8=_ref6[1],xb=_ref8[0],yb=_ref8[1],_ref9=_ref6[2],xc=_ref9[0],yc=_ref9[1];if(xc>r1){_ref10=[xc,yc],yc=_ref10[0],xc=_ref10[1]}t=Math.pow(xc,2)/Math.pow(r1,2);u=Math.pow(yc,2);r2=Math.sqrt(u/(1-t));sweep=oya===oyb?oxc>oxa?oyc<oya?1:0:oyc<oya?0:1:oxa===oxb?oya<oyb?oxc<oxa?0:1:oxc<oxa?1:0:xc<0&&yc<0||xc>0&&yc>0?0:1;return{r1:r1,r2:r2,xcenter:xcenter,ycenter:ycenter,angle:toDeg(angle),sweep:sweep}};calculatePie=function(xa,ya,xb,yb,xc,yc){var large,r;large=isLeftSide(xa,ya,xb,yb,xc,yc)?0:1;r=(distance(xa,ya,xc,yc)+distance(xb,yb,xc,yc))/2;return{r:r,large:large}};module.exports={calculateEllipse:calculateEllipse,calculatePie:calculatePie,avg:avg}}).call(this)},{}],8:[function(require,module,exports){var global=typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};(function(){var embeddedJS;exports.generateMap=require("./generateMap").generateMap;embeddedJS=require("./embeddedJS");if(global.window!=null){global.window.mapReporting={generateMap:function(config,zones){embeddedJS.setClientScope(this,config.labels);return module.exports.generateMap(config,zones)}}}}).call(this)},{"./embeddedJS":5,"./generateMap":6}],9:[function(require,module,exports){(function(){var lagrange,lpad,__hasProp={}.hasOwnProperty;exports.hash=function(str){return str.split("").reduce(function(a,b){a=(a<<5)-a+b.charCodeAt(0);return a&a},0)>>>0};exports.strRepeat=function(str,nb){return new Array(nb+1).join(str)};lpad=function(str,pad,len){return(str.length<len?exports.strRepeat(pad,len-str.length):"")+str};exports.toHTML=function(str){return str.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};lagrange=function(val,a,b,c,d,e,f){return(a*Math.pow(val,4)+b*Math.pow(val,3)+c*Math.pow(val,2)+d*val+e)/f};exports.getColor=function(val,color,invert){var b,g,r;if(invert==null){invert=false}if(invert){val=100-val}color=color.toLowerCase();if(color==="blue"){r=lagrange(val,-57,12350,-729375,-5093750,135e7,9375e3);g=lagrange(val,-31,6790,-457625,6481250,403125e3,1875e3);b=lagrange(val,-13,3190,-240875,4156250,440625e3,1875e3)}else if(color==="red"){r=lagrange(val,19,-4950,295625,-7593750,2390625e3,9375e3);g=lagrange(val,23,-3350,173125,-18343750,1546875e3,9375e3);b=lagrange(val,-33,7250,-474375,343750,1125e6,9375e3)}else if(color==="green"){r=lagrange(val,23,-3850,203125,-13906250,1471875e3,9375e3);g=lagrange(val,7,-1200,59375,-4218750,914062500,4687500);b=lagrange(val,7,-1230,66125,-3543750,2775e5,1875e3)}return"#"+lpad(Math.round(r).toString(16),"0",2)+lpad(Math.round(g).toString(16),"0",2)+lpad(Math.round(b).toString(16),"0",2)};exports.buildCSS=function(styling,id){var container,css,k,selector,style,v;container="#"+id;if(styling!=null){css=function(){var _results;_results=[];for(selector in styling){if(!__hasProp.call(styling,selector))continue;style=styling[selector];_results.push(container+" "+selector+" {\n"+function(){var _results1;_results1=[];for(k in style){if(!__hasProp.call(style,k))continue;v=style[k];_results1.push("	"+k+" : "+v+";")}return _results1}().join("\n")+"\n}\n")}return _results}();return css.join("\n")}else{return""}}}).call(this)},{}]},{},[8]);